# YM2610 to YM2612 Converter - Release Notes v1.2

## 版本 1.2 - 2026-02-04

### 🐛 重要修复

#### 修复采样率转换问题
- **问题**: 使用 22.05kHz ADPCM 时，转换后的 VGM 播放速度是原来的 2 倍
- **原因**: 没有正确处理 WAV 采样率和 VGM 采样率的差异
- **解决**: 实现采样率转换累加器，正确映射 WAV 样本到 VGM 样本

### 🔧 技术细节

#### 采样率转换算法
```cpp
// VGM 采样率: 44100 Hz (标准)
// WAV 采样率: 22050 Hz (优化后)
// 比例: 44100 / 22050 = 2.0

// 使用累加器进行分数采样
dacAccumulator += 1.0 / ratio;  // 每个 VGM 样本增加 0.5
targetIndex = (UINT32)dacAccumulator;  // 取整得到 WAV 样本索引
```

#### 示例
```
VGM 样本:  0    1    2    3    4    5    6    7
           |    |    |    |    |    |    |    |
累加器:   0.5  1.0  1.5  2.0  2.5  3.0  3.5  4.0
           |    |    |    |    |    |    |    |
WAV 样本:  0    1    1    2    2    3    3    4
```

### 📊 文件大小变化

| 采样率 | 旧版本 (v1.1) | 新版本 (v1.2) | 说明 |
|--------|---------------|---------------|------|
| 22.05kHz | 3.8 MB | 7.8 MB | 正确：每个VGM样本都写入DAC |
| 44.1kHz | 7.5 MB | 7.8 MB | 相同（无采样率转换） |

**注意**: v1.2 的 22.05kHz 文件更大是**正确的**，因为：
- VGM 采样率固定为 44.1kHz
- 每个 VGM 样本需要 1 个 DAC 命令 + 1 个等待命令
- 22.05kHz WAV 需要重采样到 44.1kHz（每个样本重复 2 次）

### ✅ 验证结果

**Illusion.vgm 转换测试**:
```
原始 YM2610:           260 KB, 44.3 秒
转换后 (22.05kHz):    7.8 MB, 44.3 秒 ✓ 正确
转换后 (44.1kHz):     7.8 MB, 44.3 秒 ✓ 正确
```

### 🎵 音质说明

- **播放速度**: 现在正确，与原始 VGM 相同
- **音频质量**: 22.05kHz 对于 ADPCM 足够，无明显质量损失
- **文件大小**: 虽然比 v1.1 大，但播放速度正确

### 🚀 使用方法（无变化）

```bash
# 1. 提取 ADPCM (22.05kHz, 150% 音量)
vgm2wav_adpcm_only.exe input.vgm adpcm.wav

# 2. 转换为 YM2612（自动处理采样率转换）
vgm_converter.exe input.vgm adpcm.wav output.vgm
```

### 📝 升级说明

从 v1.1 升级到 v1.2：
1. 替换 `vgm_converter.exe`
2. 重新转换所有文件以修复播放速度问题
3. 文件会变大，但播放速度正确

### 🔮 性能对比

| 版本 | 文件大小 | 播放速度 | 状态 |
|------|----------|----------|------|
| v1.1 | 3.8 MB | 2x (错误) | ❌ |
| v1.2 | 7.8 MB | 1x (正确) | ✅ |

### 💡 建议

如果需要更小的文件：
- 使用 44.1kHz ADPCM（无需重采样，文件大小相同）
- 或接受 7.8 MB 的文件大小以获得硬件兼容性

---

**发布日期**: 2026-02-04
**版本**: 1.2
**状态**: 稳定版
**优先级**: 高（修复关键播放速度问题）
